# TODO: Fitbit Body Management AI Agent

> PMであるClaudeがチケットを管理するファイル。
> ステータス: `[ ]` 未着手 / `[>]` 進行中 / `[x]` 完了

---

## Phase 0: プロジェクトセットアップ

### TASK-001: Spring Boot プロジェクト初期化
- **優先度**: 高
- **機能ID**: -
- **概要**: backend/ に Spring Boot 3.x + Maven プロジェクトを生成する
- **受入条件**:
  - [ ] `backend/pom.xml` に必要な依存関係が定義されている
  - [ ] `mvn compile` が成功する
  - [ ] パッケージ構成が docs/architecture.md に準拠している
- **ステータス**: `[x]`

### TASK-002: React プロジェクト初期化
- **優先度**: 高
- **機能ID**: -
- **概要**: frontend/ に React + TypeScript + Vite プロジェクトを生成する
- **受入条件**:
  - [ ] `frontend/package.json` に必要な依存関係が定義されている
  - [ ] `npm run build` が成功する
  - [ ] ディレクトリ構成が docs/repository-structure.md に準拠している
- **ステータス**: `[ ]`

### TASK-003: Docker Compose ローカル開発環境構築
- **優先度**: 高
- **機能ID**: -
- **概要**: docker/docker-compose.yml で PostgreSQL + Spring Boot のローカル環境を構築する
- **受入条件**:
  - [ ] `docker compose up` でPostgreSQLが起動する
  - [ ] Spring BootからPostgreSQLに接続できる
- **ステータス**: `[ ]`
- **ブロック**: TASK-001

### TASK-004: Flyway DBマイグレーション初期設定
- **優先度**: 高
- **機能ID**: -
- **概要**: 基本設計書のデータモデルに基づき、Flywayマイグレーションファイルを作成する
- **受入条件**:
  - [ ] 全テーブル（users, oauth_tokens, body_records, activity_records, sleep_records, nutrition_records, heart_rate_records, goals, ai_advices, chat_messages）が作成される
  - [ ] インデックスが設計通りに作成される
  - [ ] `mvn flyway:migrate` が成功する
- **ステータス**: `[ ]`
- **ブロック**: TASK-003

### TASK-005: GitHub Actions CI パイプライン構築
- **優先度**: 中
- **機能ID**: -
- **概要**: PR時のテスト実行、main マージ時のビルドを自動化する
- **受入条件**:
  - [ ] PRでバックエンド・フロントエンドのテストが自動実行される
  - [ ] テスト失敗時にPRでステータスが表示される
- **ステータス**: `[ ]`

---

## Phase 1: 認証・ユーザー管理

### TASK-010: Fitbit OAuth2.0 ログイン（バックエンド）
- **優先度**: 高
- **機能ID**: FR-001
- **概要**: Spring Security + OAuth2 Client で Fitbit OAuth2.0 認証を実装する
- **受入条件**:
  - [ ] `GET /api/auth/login` でFitbit認可URLにリダイレクトされる
  - [ ] `GET /api/auth/callback` でトークン取得・暗号化保存・セッション生成が行われる
  - [ ] トークン自動リフレッシュが動作する
- **ステータス**: `[ ]`
- **ブロック**: TASK-001, TASK-004

### TASK-011: ログイン画面（フロントエンド）
- **優先度**: 高
- **機能ID**: FR-001, SCR-001
- **概要**: Fitbitログインボタンを持つログイン画面を実装する
- **受入条件**:
  - [ ] `/login` にログインボタンが表示される
  - [ ] ボタン押下でFitbit認可画面に遷移する
  - [ ] 認証成功後に `/dashboard` にリダイレクトされる
- **ステータス**: `[ ]`
- **ブロック**: TASK-002, TASK-010

### TASK-012: ユーザープロフィール管理（バックエンド）
- **優先度**: 中
- **機能ID**: FR-002
- **概要**: プロフィール取得・編集APIを実装する
- **受入条件**:
  - [ ] `GET /api/users/me` で現在のプロフィールが返却される
  - [ ] `PUT /api/users/me` でプロフィールが更新される
  - [ ] 初回ログイン時にFitbit APIからプロフィールが自動取得される
- **ステータス**: `[ ]`
- **ブロック**: TASK-010

### TASK-013: ログアウト
- **優先度**: 中
- **機能ID**: FR-003
- **概要**: ログアウトAPIとフロントエンドのログアウト処理を実装する
- **受入条件**:
  - [ ] `POST /api/auth/logout` でセッションが破棄される
  - [ ] ログアウト後にログイン画面にリダイレクトされる
  - [ ] 未認証で保護画面にアクセスするとログイン画面に遷移する
- **ステータス**: `[ ]`
- **ブロック**: TASK-010

---

## Phase 2: Fitbit データ連携

### TASK-020: Fitbit APIクライアント実装
- **優先度**: 高
- **機能ID**: FR-010
- **概要**: FitbitApiClient / FitbitRateLimiter を実装する
- **受入条件**:
  - [ ] 各データ種別（body, activity, sleep, nutrition, heart_rate）のAPI呼び出しが動作する
  - [ ] レート制限カウンターが正しく動作する（安全マージン145で停止）
  - [ ] 401応答時にトークンリフレッシュ→リトライが行われる
- **ステータス**: `[ ]`
- **ブロック**: TASK-010

### TASK-021: データ同期サービス実装
- **優先度**: 高
- **機能ID**: FR-010, FR-011
- **概要**: SyncService / SyncController を実装する
- **受入条件**:
  - [ ] `POST /api/sync` で全データ種別が並列取得・DB保存される
  - [ ] 初回同期時は過去90日分を取得する
  - [ ] 差分同期（前回同期日以降）が動作する
  - [ ] 部分同期（一部失敗時）でエラーが返却される
- **ステータス**: `[ ]`
- **ブロック**: TASK-020

---

## Phase 3: ダッシュボード

### TASK-030: ダッシュボードAPI実装（バックエンド）
- **優先度**: 高
- **機能ID**: FR-020, FR-021, FR-022
- **概要**: DashboardService / DashboardController を実装する
- **受入条件**:
  - [ ] `GET /api/dashboard/summary` で当日のサマリーデータが返却される
  - [ ] `GET /api/dashboard/charts/{type}` で指定期間のグラフデータが返却される
  - [ ] `GET /api/dashboard/progress` で目標進捗が返却される
- **ステータス**: `[ ]`
- **ブロック**: TASK-021

### TASK-031: ダッシュボード画面（フロントエンド）
- **優先度**: 高
- **機能ID**: FR-020, FR-021, FR-022, SCR-002
- **概要**: サマリーカード・推移グラフ・目標進捗をダッシュボード画面に実装する
- **受入条件**:
  - [ ] サマリーカードに体重・歩数・カロリー・睡眠が表示される
  - [ ] データ未登録時は「--」が表示される
  - [ ] 推移グラフが表示され、期間切替が動作する
  - [ ] 目標進捗のプログレスバーが表示される
- **ステータス**: `[ ]`
- **ブロック**: TASK-030

### TASK-032: グラフ詳細画面（フロントエンド）
- **優先度**: 中
- **機能ID**: FR-021, SCR-003
- **概要**: 各指標の詳細グラフ画面を実装する
- **受入条件**:
  - [ ] `/dashboard/charts/:type` で各指標の詳細グラフが表示される
  - [ ] 1週間/1ヶ月/3ヶ月/カスタム期間の切替が動作する
  - [ ] ツールチップで詳細値が表示される
- **ステータス**: `[ ]`
- **ブロック**: TASK-031

---

## Phase 4: 目標設定

### TASK-040: 目標管理API実装（バックエンド）
- **優先度**: 高
- **機能ID**: FR-030, FR-031
- **概要**: GoalService / GoalController を実装する
- **受入条件**:
  - [ ] 目標のCRUD (GET/POST/PUT/DELETE /api/goals) が動作する
  - [ ] 体重目標の減量ペースバリデーション（0.5〜1.0kg/週）が動作する
  - [ ] 過度な目標設定時に警告レスポンスが返却される
- **ステータス**: `[ ]`
- **ブロック**: TASK-004

### TASK-041: 目標設定画面（フロントエンド）
- **優先度**: 高
- **機能ID**: FR-030, FR-031, SCR-004
- **概要**: 体重目標・日次活動目標の設定フォームを実装する
- **受入条件**:
  - [ ] 目標体重・達成期限を入力・保存できる
  - [ ] 日次目標（歩数・カロリー）を入力・保存できる
  - [ ] 過度な目標時に警告ダイアログが表示される
  - [ ] 既存目標の変更・削除ができる
- **ステータス**: `[ ]`
- **ブロック**: TASK-040

---

## Phase 5: AIコーチング

### TASK-050: Claude APIクライアント実装
- **優先度**: 高
- **機能ID**: FR-040, FR-041, FR-042
- **概要**: ClaudeApiClient / PromptBuilder を実装する
- **受入条件**:
  - [ ] Claude API呼び出し（非ストリーミング）が動作する
  - [ ] Claude API呼び出し（ストリーミング）が動作する
  - [ ] リトライ（指数バックオフ）が動作する
  - [ ] プロンプトテンプレートの変数埋め込みが動作する
- **ステータス**: `[ ]`
- **ブロック**: TASK-001

### TASK-051: 日次アドバイス生成（バックエンド）
- **優先度**: 高
- **機能ID**: FR-040
- **概要**: AdviceService / AdviceController の日次アドバイス機能を実装する
- **受入条件**:
  - [ ] `POST /api/advice/daily` でAIアドバイスが生成・保存される
  - [ ] プロンプトにユーザーのヘルスデータ・目標・7日間トレンドが含まれる
  - [ ] `GET /api/advice/daily/{date}` で保存済みアドバイスが取得できる
- **ステータス**: `[ ]`
- **ブロック**: TASK-050, TASK-021

### TASK-052: 日次アドバイス表示（フロントエンド）
- **優先度**: 高
- **機能ID**: FR-040, SCR-002
- **概要**: ダッシュボードにAIアドバイスカードを追加する
- **受入条件**:
  - [ ] ダッシュボードにアドバイスカードが表示される
  - [ ] 再生成ボタンでアドバイスを更新できる
- **ステータス**: `[ ]`
- **ブロック**: TASK-051, TASK-031

### TASK-053: 週次レポート生成
- **優先度**: 中
- **機能ID**: FR-041
- **概要**: 週次レポートの生成API・表示画面を実装する
- **受入条件**:
  - [ ] `POST /api/advice/weekly` で週次レポートが生成・保存される
  - [ ] `GET /api/advice/weekly` で過去の週次レポート一覧が取得できる
  - [ ] SCR-006 で週次レポートが閲覧できる
- **ステータス**: `[ ]`
- **ブロック**: TASK-051

### TASK-054: チャットコーチング（バックエンド）
- **優先度**: 中
- **機能ID**: FR-042
- **概要**: ChatService / ChatController（SSEストリーミング）を実装する
- **受入条件**:
  - [ ] `POST /api/chat/messages` でSSEストリーミング応答が返却される
  - [ ] 会話履歴がDBに保存される
  - [ ] プロンプトにヘルスデータ・会話履歴が含まれる
- **ステータス**: `[ ]`
- **ブロック**: TASK-050

### TASK-055: チャット画面（フロントエンド）
- **優先度**: 中
- **機能ID**: FR-042, SCR-005
- **概要**: AIコーチとのチャットUIを実装する
- **受入条件**:
  - [ ] メッセージを入力・送信できる
  - [ ] AIの応答がストリーミングでリアルタイム表示される
  - [ ] 会話の文脈が維持される
- **ステータス**: `[ ]`
- **ブロック**: TASK-054

---

## Phase 6: プロフィール・設定

### TASK-060: プロフィール画面（フロントエンド）
- **優先度**: 低
- **機能ID**: FR-002, SCR-007
- **概要**: ユーザー情報編集画面を実装する
- **受入条件**:
  - [ ] プロフィール情報が表示・編集・保存できる
- **ステータス**: `[ ]`
- **ブロック**: TASK-012

### TASK-061: 設定画面（フロントエンド）
- **優先度**: 低
- **機能ID**: SCR-008
- **概要**: データ管理・アカウント設定画面を実装する
- **受入条件**:
  - [ ] 手動同期ボタンが動作する
  - [ ] ログアウトボタンが動作する
- **ステータス**: `[ ]`
- **ブロック**: TASK-013, TASK-021

---

## Phase 7: 共通UI・レイアウト

### TASK-070: 共通レイアウト実装（フロントエンド）
- **優先度**: 高
- **機能ID**: -
- **概要**: Header / BottomNav / AuthLayout を実装する
- **受入条件**:
  - [ ] 認証済み画面にヘッダー・ナビゲーションが表示される
  - [ ] モバイルでボトムナビゲーションが表示される
  - [ ] 未認証時にログイン画面へリダイレクトされる
- **ステータス**: `[ ]`
- **ブロック**: TASK-002

---

## 更新履歴
- 2026-02-09: 初版作成（MVP全チケット起票）
