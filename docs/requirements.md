# 要件定義書: Fitbit Body Management AI Agent

## 目次
1. [はじめに](#1-はじめに)
2. [背景・課題](#2-背景課題)
3. [ユーザーペルソナ](#3-ユーザーペルソナ)
4. [機能要件](#4-機能要件)
5. [非機能要件](#5-非機能要件)
6. [成功指標（KPI）](#6-成功指標kpi)
7. [制約事項・前提条件](#7-制約事項前提条件)
8. [リリース計画](#8-リリース計画)

---

## 1. はじめに

### 1.1 本ドキュメントの目的
本ドキュメントは、Fitbit Body Management AI Agentが「何を実現するか」を定義する。
ビジネス目標・ユーザー課題・必要な機能を明確にし、関係者間の合意形成を目的とする。

### 1.2 対象読者
- プロダクトオーナー / ステークホルダー
- デザイナー
- 開発チーム（要件理解のため）

### 1.3 関連ドキュメント
| ドキュメント | ファイル | 概要 |
|-------------|---------|------|
| 企画書 | docs/planning.md | プロダクトコンセプト・技術スタック |
| 基本設計書 | docs/basic-functional-design.md | 画面・データモデル・状態遷移等の技術設計 |

### 1.4 用語定義
| 用語 | 定義 |
|------|------|
| ユーザー | Fitbitデバイスを所有しアプリを利用する一般利用者 |
| コーチング | AIが生成するパーソナライズされた体型管理アドバイス |
| ヘルスデータ | Fitbit APIから取得する体重・運動・睡眠・食事・心拍等のデータ |
| セッション | ユーザーがログインしてからログアウトするまでの一連の操作 |

---

## 2. 背景・課題

### 2.1 市場背景
- ウェアラブルデバイス市場は拡大を続け、Fitbitは世界有数のユーザー基盤を持つ
- ヘルスケアデータは蓄積されているが、多くのユーザーが**データを行動に変換できていない**
- 生成AIの進化により、パーソナライズされたアドバイスのリアルタイム生成が実現可能になった

### 2.2 解決する課題

| # | 課題 | 詳細 |
|---|------|------|
| C-1 | アクション不足 | Fitbitはデータを記録するが、具体的な「次に何をすべきか」の提案が弱い |
| C-2 | 継続困難 | 体型管理は継続が難しく、モチベーション維持のサポートが不足している |
| C-3 | パーソナライズ不足 | 個人の体質・生活リズムに合ったアドバイスが得られない |

### 2.3 提供価値
本アプリは上記課題に対して以下の価値を提供する。

| 課題 | 提供価値 |
|------|---------|
| C-1 → | ヘルスデータに基づき、AIが具体的なアクションを日次・週次で提案する |
| C-2 → | 目標に対する進捗可視化と、AIによる励まし・フィードバックで継続を支援する |
| C-3 → | ユーザー個人のデータトレンドを分析し、パーソナライズされたコーチングを提供する |

---

## 3. ユーザーペルソナ

### ペルソナA: データ活用初心者（メインターゲット）
- **属性**: 30代会社員、デスクワーク中心
- **Fitbit利用歴**: 1年以上だがアプリをたまに見る程度
- **課題**: データは溜まっているが何をすべきかわからない
- **ゴール**: 具体的な行動指針が欲しい、体重を5kg落としたい
- **利用シーン**: 朝の通勤前にダッシュボードを確認、昼休みにAIチャットで食事相談

### ペルソナB: 自己管理ガチ勢
- **属性**: 20代後半、筋トレ・ランニングを定期的に実施
- **Fitbit利用歴**: 2年以上、データを日常的に確認
- **課題**: 自己流の管理に限界を感じている
- **ゴール**: データに基づいた最適なトレーニング・食事プランが欲しい
- **利用シーン**: トレーニング後にデータ確認、週末に週次レポートで振り返り

---

## 4. 機能要件

### 4.1 認証・ユーザー管理

#### FR-001: Fitbit OAuth2.0ログイン
- **概要**: Fitbitアカウントを用いたOAuth2.0認証でログインする
- **詳細**:
  - Authorization Code Grant Flowを使用
  - 要求スコープ: `activity`, `heartrate`, `nutrition`, `sleep`, `weight`
  - アクセストークン・リフレッシュトークンをサーバー側で安全に保管
  - トークン有効期限切れ時に自動リフレッシュ
- **受入条件**:
  - Fitbitアカウントでログインできる
  - 認可画面でスコープ同意後、アプリにリダイレクトされる
  - ログイン状態がセッション終了まで維持される

#### FR-002: ユーザープロフィール管理
- **概要**: ユーザーの基本情報と目標を管理する
- **詳細**:
  - Fitbit APIからプロフィール情報を取得（名前、年齢、性別、身長）
  - アプリ独自のプロフィール項目を追加設定可能（活動レベル、食事傾向等）
- **受入条件**:
  - 初回ログイン時にFitbitプロフィールが自動取得される
  - プロフィール情報を編集・保存できる

#### FR-003: ログアウト
- **概要**: ユーザーがアプリからログアウトする
- **詳細**:
  - セッションを破棄する
  - Fitbitトークンはサーバー側に保持（再ログイン時の再認可を省略）
- **受入条件**:
  - ログアウト後、ログイン画面にリダイレクトされる
  - ログアウト後に認証が必要な画面にアクセスするとログイン画面に遷移する

---

### 4.2 Fitbitデータ連携

#### FR-010: データ同期
- **概要**: Fitbit APIからヘルスデータを取得しDBに保存する
- **詳細**:
  - 取得データ:
    - Body: 体重(kg)、体脂肪率(%)、BMI
    - Activity: 歩数、消費カロリー(kcal)、運動記録（種目・時間・消費カロリー）
    - Sleep: 睡眠時間(分)、睡眠ステージ（deep/light/rem/wake）
    - Nutrition: 摂取カロリー(kcal)、水分摂取量(ml)
    - Heart Rate: 安静時心拍数、心拍ゾーン別時間
  - 同期タイミング:
    - ユーザーログイン時に最新データを自動同期
    - ダッシュボード表示時に前回同期からの差分を取得
    - 手動同期ボタンによる任意同期
  - レート制限（150 req/hour/user）を考慮したリクエスト制御
- **受入条件**:
  - ログイン時にFitbitの最新データが同期される
  - 手動同期ボタンを押すとデータが更新される
  - レート制限に達した場合、エラーメッセージを表示する

#### FR-011: データ取得期間
- **概要**: 過去データの取得範囲を定義する
- **詳細**:
  - 初回同期時: 過去90日分のデータを取得
  - 通常同期時: 前回同期日から現在までの差分を取得
  - ユーザーが過去データの取得期間を手動指定可能（最大1年）
- **受入条件**:
  - 初回ログイン後、過去90日分のデータがダッシュボードに表示される

---

### 4.3 ダッシュボード

#### FR-020: サマリー表示
- **概要**: 今日のヘルスデータサマリーをカード形式で表示する
- **表示項目**:
  - 本日の体重（前日比）
  - 本日の歩数（目標に対する達成率）
  - 本日の消費カロリー
  - 本日の摂取カロリー
  - カロリー収支（消費 - 摂取）
  - 昨晩の睡眠時間・品質スコア
- **受入条件**:
  - ログイン後のトップ画面にサマリーカードが表示される
  - データ未登録の項目は「--」と表示される

#### FR-021: 推移グラフ
- **概要**: 各指標の時系列推移をグラフで表示する
- **詳細**:
  - 対応グラフ:
    - 体重推移（折れ線グラフ）
    - 歩数推移（棒グラフ）
    - 睡眠時間推移（積み上げ棒グラフ: ステージ別）
    - カロリー収支推移（折れ線: 摂取 vs 消費）
    - 心拍数推移（折れ線グラフ）
  - 表示期間切替: 1週間 / 1ヶ月 / 3ヶ月 / カスタム
- **受入条件**:
  - 各指標のグラフが表示される
  - 表示期間をボタンで切り替えられる
  - データポイントにホバーすると詳細値がツールチップで表示される

#### FR-022: 目標進捗表示
- **概要**: 設定した目標に対する進捗を可視化する
- **詳細**:
  - 体重目標: 現在体重→目標体重のプログレスバー
  - 日次目標: 歩数・消費カロリーの達成率リング
- **受入条件**:
  - 目標設定済みの場合、進捗が視覚的に確認できる
  - 目標未設定の場合、設定画面への導線が表示される

---

### 4.4 目標設定

#### FR-030: 体重目標設定
- **概要**: 目標体重と達成期限を設定する
- **詳細**:
  - 入力項目: 目標体重(kg)、達成目標日
  - 現在体重との差分から必要なカロリー収支を自動計算
  - 健康的な減量ペース（0.5〜1.0kg/週）を超える場合に警告表示
- **受入条件**:
  - 目標体重と期限を設定・保存できる
  - 無理のある目標設定時に警告が表示される
  - 目標を変更・削除できる

#### FR-031: 日次活動目標設定
- **概要**: 日々の活動目標を設定する
- **詳細**:
  - 設定項目: 目標歩数、目標消費カロリー、目標摂取カロリー
  - Fitbit側の設定値をデフォルト値として取得
- **受入条件**:
  - 各日次目標を設定・保存できる
  - デフォルト値がFitbitの設定値で初期化される

---

### 4.5 AIコーチング

#### FR-040: 日次アドバイス生成
- **概要**: 当日のデータに基づきAIが体型管理アドバイスを生成する
- **詳細**:
  - 入力データ: 当日のヘルスデータ全項目 + 目標設定 + 直近7日間のトレンド
  - 生成内容:
    - 今日のデータに対する評価（良かった点・改善点）
    - 具体的なアクション提案（2〜3個）
    - モチベーションメッセージ
  - Claude APIを使用して自然言語で生成
  - 1日1回、データ同期後に自動生成
  - 手動での再生成も可能
- **受入条件**:
  - ダッシュボードにAIアドバイスカードが表示される
  - アドバイスがユーザーのデータに基づいてパーソナライズされている
  - 再生成ボタンでアドバイスを更新できる

#### FR-041: 週次レポート生成
- **概要**: 1週間の振り返りと来週のアクションプランをAIが生成する
- **詳細**:
  - 入力データ: 過去7日間のヘルスデータ + 目標 + 前週との比較
  - 生成内容:
    - 週間サマリー（各指標の平均値・推移）
    - 目標に対する進捗評価
    - 来週の具体的なアクションプラン（3〜5個）
    - 長期トレンドに基づくインサイト
  - 毎週月曜日に自動生成
- **受入条件**:
  - 週次レポートが閲覧できる
  - 過去の週次レポートを一覧で確認できる

#### FR-042: チャットコーチング
- **概要**: ユーザーがAIコーチにチャット形式で質問・相談できる
- **詳細**:
  - ユーザーのヘルスデータをコンテキストとして保持
  - 体型管理に関する質問に対して、ユーザーのデータを踏まえた回答を生成
  - 会話履歴を保持（セッション内）
- **受入条件**:
  - チャット画面でAIに質問できる
  - 回答がユーザーのヘルスデータを踏まえたものになっている
  - 会話の文脈が維持される

---

## 5. 非機能要件

### 5.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| ページ読み込み | 初回ロード3秒以内、遷移1秒以内 |
| データ同期 | 90日分の初回同期を60秒以内に完了 |
| AIアドバイス生成 | 10秒以内にレスポンスを返す |
| チャット応答 | ストリーミングで1秒以内に最初のトークンを返す |

### 5.2 セキュリティ

| 項目 | 要件 |
|------|------|
| 通信 | 全通信をHTTPS (TLS 1.2+) で暗号化 |
| トークン管理 | OAuth2.0トークンはサーバー側で暗号化保存、クライアント側に露出しない |
| 認証 | セッションベース認証、セッションタイムアウト30分 |
| データ保護 | ヘルスデータは個人情報として暗号化保存 |
| CSRF対策 | CSRFトークンによるリクエスト検証 |
| XSS対策 | 出力エスケープ・Content Security Policy適用 |

### 5.3 可用性

| 項目 | 要件 |
|------|------|
| 稼働率 | 99.5%以上（月間ダウンタイム約3.6時間以内） |
| バックアップ | 日次自動バックアップ、7日間保持 |
| 障害復旧 | RPO: 24時間、RTO: 4時間 |

### 5.4 スケーラビリティ

| 項目 | 要件 |
|------|------|
| MVP想定ユーザー数 | 100ユーザー |
| 同時接続数 | 20ユーザー |
| データ保持期間 | 2年間 |

### 5.5 対応環境

| 項目 | 要件 |
|------|------|
| ブラウザ | Chrome / Safari / Firefox（各最新版） |
| デバイス | PC / タブレット / スマートフォン（レスポンシブ） |

---

## 6. 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| MVP登録ユーザー数 | 50人（リリース後3ヶ月） | ユーザーDB集計 |
| 週次アクティブユーザー率 | 60%以上 | ログインログ |
| AIアドバイス閲覧率 | 70%以上 | 画面閲覧ログ |
| 目標設定率 | 80%以上 | goals テーブル集計 |
| ユーザー満足度 | 4.0/5.0以上 | アンケート |

---

## 7. 制約事項・前提条件

### 7.1 制約事項
- Fitbit APIのレート制限（150 req/hour/user）に従う
- ヘルスデータの取り扱いは個人情報保護法に準拠する
- Claude APIの利用コストを考慮し、不要なAPI呼び出しを抑制する

### 7.2 前提条件
- ユーザーはFitbitデバイスを所有しFitbitアカウントを持っている
- ユーザーはFitbitデバイスで日常的にデータを記録している
- Fitbit Web APIが安定稼働している
- Claude APIが安定稼働している

### 7.3 スコープ外（MVP）
- ネイティブモバイルアプリ
- 多言語対応（日本語のみ）
- 複数Fitbitデバイスの同時管理
- 医療目的のアドバイス提供
- ユーザー間のソーシャル機能

---

## 8. リリース計画

### Phase 1: MVP
認証・データ連携・ダッシュボード・目標設定・AIコーチングの基本機能。

### Phase 2: 拡張機能
- リマインド通知（メール/ブラウザPush通知）
- 食事提案（カロリー収支と栄養バランスに基づくメニュー提案）
- 運動プラン（運動履歴と目標に基づくトレーニングプラン自動生成）

### Phase 3: 高度な機能
- トレンド予測（過去データから体重推移を予測するモデル）
- コミュニティ（匿名での目標共有・励まし合い機能）
- 外部連携（Apple Health等との連携）

---

## 更新履歴
- 2026-02-08: 初版作成（product-requirements.md から分割）
