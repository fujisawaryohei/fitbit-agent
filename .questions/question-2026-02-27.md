# 技術Q&A — 2026-02-27

### なぜ JPA ではなく MyBatis を使うのか？

JPA（Spring Data JPA + Hibernate）とMyBatisはどちらもJavaでDBアクセスするためのライブラリだが、哲学が大きく異なる。

**JPA の特徴**:
- SQLを自動生成してくれる（`findByFitbitUserId` と書くだけでSELECT文が生成される）
- `@Entity`, `@OneToOne` などのアノテーションで関連を宣言するだけでJOINも自動
- 裏でどんなSQLが発行されているかがわかりにくい（N+1問題など罠もある）

**MyBatis の特徴**:
- SQLを自分で書く（XML ファイルにSQLを定義する）
- どんなクエリが発行されるかが常に明確で、チューニングしやすい
- SQLを直接学べるため、DBの学習に向いている
- JPA より設定が少なく、シンプルな構成になる

**今回の選択理由**: ユーザーの学習目的のため、SQLを明示的に書くMyBatisを採用する。SQLの書き方・仕組みを習得しながら実装を進められる。

### MyBatis の基本的な仕組みは？

MyBatis は以下の3要素で成り立つ:

1. **Mapper インターフェース** — DB操作のメソッドを定義する Java インターフェース
   ```java
   @Mapper
   public interface UserMapper {
       Optional<User> findByFitbitUserId(String fitbitUserId);
   }
   ```

2. **Mapper XML** — 各メソッドに対応するSQLを定義するXMLファイル
   ```xml
   <select id="findByFitbitUserId" resultMap="UserResultMap">
       SELECT * FROM users WHERE fitbit_user_id = #{fitbitUserId}
   </select>
   ```

3. **POJO（Plain Old Java Object）** — DBの1行を表す普通のJavaクラス（アノテーション不要）

MyBatisは `namespace`（インターフェースの完全クラス名）でインターフェースとXMLを紐付けて動作する。

### JPA の POJO との違いは？

| 観点 | JPA エンティティ | MyBatis POJO |
|------|----------------|--------------|
| アノテーション | `@Entity`, `@Table`, `@Column`, `@OneToOne` など多数 | なし（Lombokのみ） |
| テーブルとの対応 | アノテーションで宣言 | XMLの `<resultMap>` で定義 |
| テーブル間の関連 | `@OneToOne`, `@ManyToOne` など | XMLの `<association>` や独自SQLで表現 |
| タイムスタンプ | `@CreationTimestamp` で自動管理 | SQLの `NOW()` で明示的にセット |

### `map-underscore-to-camel-case: true` とは？

DBのカラム名（スネークケース: `fitbit_user_id`）をJavaのフィールド名（キャメルケース: `fitbitUserId`）に自動変換してくれる設定。
これにより、`<resultMap>` で全フィールドを手動マッピングしなくても、単純なカラムは自動的にマッピングされる。
ただし、UUID 型など型変換が必要なフィールドは `<resultMap>` で明示的に定義する必要がある。
